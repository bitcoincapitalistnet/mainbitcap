{% extends 'base.html' %}
{% block main %}

<main id="MainContent" class="content-for-layout focus-none" role="main" tabindex="-1">
  <div id="shopify-section-template--18680031707423__cart-items" class="shopify-section">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-cart.css?v=61086454150987525971681884298"
      rel="stylesheet" type="text/css" media="all">
      <!-- <link rel="stylesheet" href=" https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"> -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-cart-items.css?v=29412722223528841861681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-totals.css?v=86168756436424464851681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-price.css?v=65402837579211014041681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-discounts.css?v=152760482443307489271681884298"
      rel="stylesheet" type="text/css" media="all">
    <link
      href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-loading-overlay.css?v=167310470843593579841681884298"
      rel="stylesheet" type="text/css" media="all">
      <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style data-shopify="">
      .section-template--18680031707423__cart-items-padding {
        padding-top: 27px;
        padding-bottom: 27px;
      }

      @media screen and (min-width: 750px) {
        .section-template--18680031707423__cart-items-padding {
          padding-top: 36px;
          padding-bottom: 36px;
        }
      }
      
      button:focus,
input:focus{
  outline: none;
  box-shadow: none;
}
a,
a:hover{
  text-decoration: none;
}

/*--------------------------*/
.qty-container{
  display: flex;
  align-items: center;
  justify-content: center;
}
.qty-container .input-qty{
  text-align: center;
  padding: 6px 10px;
  border: 1px solid #d4d4d4;
  max-width: 80px;
}
.qty-container .qty-btn-minus,
.qty-container .qty-btn-plus{
  border: 1px solid #d4d4d4;
  padding: 10px 13px;
  font-size: 10px;
  height: 38px;
  width: 38px;
  transition: 0.3s;
}
.qty-container .qty-btn-plus{
  margin-left: -1px;
}
.qty-container .qty-btn-minus{
  margin-right: -1px;
}


/*---------------------------*/
.btn-cornered,
.input-cornered{
  border-radius: 4px;
}
.btn-rounded{
  border-radius: 50%;
}
.input-rounded{
  border-radius: 50px;
}

    </style>
    <style>
      .qty-btn {
          width: 36px;
          height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          font-size: 18px;
      }
      .qty-btn-minus {
          margin-right: 5px;
      }
      .qty-btn-plus {
          margin-left: 5px;
      }
      .delete-btn {
          margin-left: 10px;
          background-color: red;
          color: white;
          border: none;
      }
  </style>
  

    <cart-items class="page-width section-template--18680031707423__cart-items-padding">
      <div class="title-wrapper-with-link">
        <h1 class="title title--primary">Your cart</h1>
        <a href="{{url_for('Catalog')}}" class="underlined-link">Continue shopping</a>
      </div>
      {% if cart == {} %}
      <div class="cart__warnings">
        <h1 class="cart__empty-text">Your cart is empty</h1>
        <a href="/collections/all" class="button">
          Continue shopping
        </a>
      </div>
      {% else %}

      <form action="{{url_for('RemoveCart')}}" class="cart__contents critical-hidden" method="post" id="">
        <div class="cart__items" id="main-cart-items" data-id="template--18680031707423__cart-items">
          <div class="js-contents">
            <table class="cart-items">
              <caption class="visually-hidden">
                Your cart
              </caption>
              <thead>
                <tr>
                  <th class="caption-with-letter-spacing" colspan="2" scope="col">
                    Product
                  </th>
                  <th class="medium-hide large-up-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    Total
                  </th>
                  <th class="cart-items__heading--wide small-hide caption-with-letter-spacing" colspan="1" scope="col">
                    Quantity
                  </th>
                  <th class="small-hide right caption-with-letter-spacing" colspan="1" scope="col">
                    Total
                  </th>
                </tr>
              </thead>
              {% for item in cart %}
              <tbody>
                <tr class="cart-item" id="CartItem-1">
                  <td class="cart-item__media">



                    <div class="cart-item__image-container gradient global-media-settings">
                      <img src="{{ item.details['imgsrc'] }}" class="cart-item__image" alt="{{ item.details['Pname'] }}"
                        loading="lazy" width="150" height="113">
                    </div>

                  </td>

                  <td class="cart-item__details">{{ item['details']['name'] }}</a>
                    <div class="product-option">
                      ${{ "{:,.2f}".format(item['details']['price']) }}
                    </div>
                    <dl></dl>

                    <p class="product-option"></p>
                    <ul class="discounts list-unstyled" role="list" aria-label="Discount"></ul>
                  </td>

                  <td class="cart-item__totals right medium-hide large-up-hide">
                    <div class="loading-overlay hidden">
                      <div class="loading-overlay__spinner">
                        <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66"
                          xmlns="http://www.w3.org/2000/svg">
                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                      </div>
                    </div>
                    <div class="cart-item__price-wrapper"><span class="price price--end">
                        ${{ "{:,.2f}".format(item['details']['total_price']) }}

                      </span></div>
                  </td>
                  <td class="cart-item__quantity"> 

                <div class="container mt-5 pb-5">
                  <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="qty-container">
                            <button class="qty-btn-minus btn-primary btn-rounded mr-1" type="button"><i class="fa fa-chevron-left"></i></button>
                          <input type="text" name="qty" value="{{ item['details']['quantity'] }}" class="input-qty input-rounded"/>
                          <input type="hidden" name="product_id" value="{{ item['product_id'] }}"/>
                          
                            <button class="qty-btn-plus btn-primary btn-rounded ml-1" type="button"><i class="fa fa-chevron-right"></i></button>
                            <form action="/deleting" method="post">
                              
                              <input type="hidden" name="product_id" value="{{ item['product_id'] }}">
                              <button class="qty-btn delete-btn btn-rounded" type="submit"><i class="fa fa-trash"></i></button>
                          </form> 
                        </div>
                    </div>
                  </div>
                </div>
                         
                

                    <div class="cart-item__error" id="Line-item-error-1" role="alert">
                      <small class="cart-item__error-text"></small>
                      <svg aria-hidden="true" focusable="false" class="icon icon-error" viewBox="0 0 13 13">
                        <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"></circle>
                        <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"></circle>
                        <path
                          d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z"
                          fill="white"></path>
                        <path
                          d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z"
                          fill="white" stroke="#EB001B" stroke-width="0.7">
                        </path>
                      </svg>
                    </div>
                  </td>               
              
                    <!-- <form action="/deleting" method="post">  ]
                              
                                  <input type="hidden" name="product_id" value="{{ item['product_id'] }}">
                                  <button type="submit">Remove</button>
                              </form> -->
                    

                  <td class="cart-item__totals right small-hide">
                    <div class="loading-overlay hidden">
                      <div class="loading-overlay__spinner">
                        <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66"
                          xmlns="http://www.w3.org/2000/svg">
                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                      </div>
                    </div>

                    <div class="cart-item__price-wrapper"><span class="price price--end">
                        ${{ "{:,.2f}".format(item['details']['total_price']) }}

                      </span></div>
                  </td>
                </tr>
              </tbody>
              {% endfor %}
            </table>
          </div>
        </div>

        <p class="visually-hidden" id="cart-live-region-text" aria-live="polite" role="status"></p>
        <p class="visually-hidden" id="shopping-cart-line-item-status" aria-live="polite" aria-hidden="true"
          role="status">
          Loading...
        </p>
      </form>
    </cart-items>


  </div>
  <div id="shopify-section-template--18680031707423__cart-footer" class="shopify-section cart__footer-wrapper">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-cart.css?v=61086454150987525971681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-totals.css?v=86168756436424464851681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-price.css?v=65402837579211014041681884298"
      rel="stylesheet" type="text/css" media="all">
    <link href="//bitcoincapitalist.io/cdn/shop/t/2/assets/component-discounts.css?v=152760482443307489271681884298"
      rel="stylesheet" type="text/css" media="all">

    <div class="page-width" id="main-cart-footer" data-id="template--18680031707423__cart-footer">
      <div>
        <div class="cart__footer">
          <div class="cart__blocks">

            <div class="js-contents">
              <div class="totals">
                <h2 class="totals__subtotal">Subtotal</h2>
                <p class="totals__subtotal-value">${{subtotal}}</p>
              </div>

              <div></div>

              <small class="tax-note caption-large rte">Taxes and shipping calculated at checkout
              </small>
            </div>
            <div class="cart__ctas">
              <form action="{{url_for('Checkout', _externals=False)}}">
                <input type="hidden">

                <button type="submit" id="checkout" class="cart__checkout-button button" name="checkout">
                  Check out
                </button>

              </form>

            </div>

            <div id="cart-errors"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
  {% endif %}
</main>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>


<script>
  $(document).ready(function() {
    var updateTimeout;

    function updateCart(quantity, productId) {
        $.ajax({
            url: '/update_cart',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
              'Quantity': quantity,
              'Product_id': productId
            }),
            success: function(response) {
                console.log('Cart updated:', response);
                // Assuming the server responded with a success message
                if (response.message === 'Cart updated successfully') {
                    // Refresh the page to reflect the changes
                    window.location.reload(true);
                }
            },
            error: function(error) {
                console.error('Error updating cart:', error);
            }
        });
    }

    function startUpdateTimer($input, productId) {
        clearTimeout(updateTimeout);
        updateTimeout = setTimeout(function() {
            var quantity = $input.val();
            updateCart(quantity, productId);
        }, 2000); // Update delay set to 3 seconds
    }

    $(".qty-btn-plus, .qty-btn-minus").click(function() {
        var $this = $(this);
        var $qtyContainer = $this.closest(".qty-container");
        var $input = $qtyContainer.find(".input-qty");
        var productId = $qtyContainer.find("input[name='product_id']").val();
        var currentQty = parseInt($input.val(), 10);

        if ($this.hasClass('qty-btn-plus')) {
            $input.val(currentQty + 1);
        } else if ($this.hasClass('qty-btn-minus')) {
            // Ensure the quantity doesn't go below 1
            if (currentQty > 1) {
                $input.val(currentQty - 1);
            }
        }

        startUpdateTimer($input, productId);
    });

    $(".input-qty").on('input', function() {
        var $input = $(this);
        var $qtyContainer = $input.closest(".qty-container");
        var productId = $qtyContainer.find("input[name='product_id']").val();
        startUpdateTimer($input, productId);
    });
});
</script>




{% endblock main %}
